---
import BaseLayout from '../../layouts/BaseLayout.astro';
import TimelineEmbed from '../../components/TimelineEmbed.astro';
import { getCollection } from 'astro:content';

const projects = (await getCollection('projects')).sort((a, b) => {
  const aKey = `${a.data.start_date.year}-${String(a.data.start_date.month ?? 0).padStart(2, '0')}-${String(a.data.start_date.day ?? 0).padStart(2, '0')}`;
  const bKey = `${b.data.start_date.year}-${String(b.data.start_date.month ?? 0).padStart(2, '0')}-${String(b.data.start_date.day ?? 0).padStart(2, '0')}`;
  return bKey.localeCompare(aKey);
});
---

<BaseLayout title="Projects" wide>
  <h1 class="text-3xl font-bold mb-2">Projects</h1>
  <p class="text-gray-500 mb-8">Things I've built, contributed to, or helped organize.</p>

  <!-- Timeline -->
  <div class="mb-12 relative left-1/2 right-1/2 -mx-[50vw] w-screen">
    <TimelineEmbed />
  </div>

  <!-- Project Cards Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
    {projects.map((project) => (
      <a
        href={`/projects/${project.id}/`}
        class="group block bg-white rounded-xl border border-gray-200 p-5 hover:shadow-md hover:border-accent-200 transition-all no-underline"
      >
        <h3 class="font-semibold text-gray-900 group-hover:text-accent-600 transition-colors mb-1.5">
          {project.data.title}
        </h3>
        <p class="text-sm text-gray-400 mb-3">
          {project.data.display_date || `${project.data.start_date.year}`}
        </p>
        {project.data.tags && (
          <div class="flex flex-wrap gap-1.5">
            {project.data.tags.map((tag: string) => (
              <span class="text-xs bg-accent-50 text-accent-700 px-2 py-0.5 rounded-full">
                {tag}
              </span>
            ))}
          </div>
        )}
      </a>
    ))}
  </div>
</BaseLayout>
